<!DOCTYPE html>
<html>
<head>
  <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <title>HyperBrain.org</title>
  <style>
  path { opacity: 0.4; }
  </style>
</head>
<body>
<h1>HyperBrain</h1>
<form>
<input type="range" style="width: 250px;" defaultValue='25' min='1' max='104' onchange="getImage(this.value)"/>
</form>
<div id="brainImage">

</div>


<script>
var chart = d3.select('#brainImage'); 
var color = d3.scale.linear().domain([0,150]).range(['blue','red']);
var opacity = d3.scale.linear().domain([1,150]).range([0.6,1.0]);
var data = {};

function bindData(raw_data) {
  var svg = chart.select('svg');
  var regions = svg.selectAll("path");

  raw_data.forEach(function (d) {
    d.count = parseFloat(d.count);
    data[d.id] = d;
    svg.select("path[structure_id='"+d.id+"']")
      .datum(d)
        .style('fill', function (d) { return color(d.count)})
        .style('opacity', function (d) { return (d.count > 1.0) ? opacity(d.count) : 0.4 })
        .append('svg:title').text(function (d) { return d.name + ((d.count > 1) ? " (" + parseInt(d.count) + " mentions)" : '' )});
  });

}

function getImage(image_id) {
  img_url = '/img/'+image_id+'.svg';
  
  d3.xml(img_url, function(error, documentFragment) {
    if (error) {console.log(error); return;}
  
    var svgNode = documentFragment
                  .getElementsByTagName("svg")[0];
    chart.selectAll('svg').remove(); 
    chart.node().appendChild(svgNode);
    d3.select('#range').style('width', svgNode.width.toString() + 'px')
  
    var svg = chart.select("svg");
    d3.csv("abi.csv", bindData);
})};

getImage(25);
</script>

</body>
</html>
